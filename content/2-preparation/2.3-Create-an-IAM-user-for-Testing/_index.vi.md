+++
title = "Tạo IAM user để kiểm thử"
date = 2025
weight = 3
chapter = false
pre = "<b>2.3. </b>"
+++

## Tạo người dùng IAM để kiểm thử

Trong phần này, chúng ta sẽ gán policy cho role đã tạo trước đó để đảm bảo role có các quyền phù hợp được định nghĩa trong policy.

1. Truy cập **IAM Dashboard**

   - Tìm kiếm **IAM**.
   - Nhấn để truy cập **IAM Dashboard**.

   ![IAM](/images/2/2.3/IAM_Dashboard.png?width=90pc)

2. Tạo IAM policy trong **IAM Dashboard**
   - Tìm **Policies** ở side panel và chọn **Create policy**.

   ![IAM](/images/2/2.3/Create_policy.png?width=90pc)
   
   - Trong mục **Specify permission**, tại **Policy editor** nhấn chọn **JSON** để chuyển sang định dạng JSON, sau đó dán đoạn JSON sau vào:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Deny",
            "Action": [
                "ec2:TerminateInstances",
                "ec2:DeleteTags",
                "ec2:CreateTags"
            ],
            "Resource": "*",
            "Condition": {
                "StringEquals": {
                    "aws:ResourceTag/status": "isolated"
                }
            }
        }
    ]
}
```

   ![IAM](/images/2/2.3/Create_policy_add_policy.png?width=90pc)

   - Nhấn **Next**.
   - Trong phần **Review and create**, tại _Policy details_, đặt tên policy là: `Deny-termination-of-isolated-instances`.

   ![IAM](/images/2/2.3/Create_policy_naming.png?width=90pc)

   - Giữ nguyên các thiết lập còn lại và nhấn **Create policy**. Sau đó bạn sẽ được chuyển về giao diện **Policy**.

{{% notice info %}}
Trong tình huống thực tế, tác giả khuyến nghị sử dụng [Service control policies (SCP)](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html)
{{% /notice %}}

3. Tạo **Group**

   - Trong giao diện **Policy**, ở left side panel, chọn **User groups**.
   - Nhấn **Create group**.

   ![IAM](/images/2/2.3/Create_group.png?width=90pc)

   - Tại phần **Create user group**, đặt tên group là: `ec2-user`.
   - Tại **Attach permissions policies**, gán các policy sau cho group:
     - `AmazonEC2FullAccess` (AWS Managed Policy)
     - `Deny-termination-of-isolated-instances` (policy vừa tạo)

   ![IAM](/images/2/2.3/Create_group_naming.png?width=90pc)

   - Nhấn **Create group**, kết quả sẽ như sau:

   ![IAM](/images/2/2.3/Create_group_result.png?width=90pc)

4. Tạo **user**

   - Quay lại side panel, chọn **Users** rồi nhấn **Create user**.

   ![IAM](/images/2/2.3/Create_user.png?width=90pc)

   - Trong phần _Specify user details_, đặt tên **User name** là: `testuser`.
   - Chọn **yes** tại _Provide user access to the AWS Management console_.
   - Chọn _I want to create an IAM user_. Bạn có thể chọn **autogenerated password** hoặc **custom password**.
   - Bỏ chọn _User must create a new password at next sign-in_ nếu không cần.

   ![IAM](/images/2/2.3/Create_user_details.png?width=90pc)

   - Nhấn **Next** để sang phần **Set permission**.
   - Tại _Permissions options_, giữ mặc định là **Add user to group**.
   - Trong _User groups_, thêm user này vào group **ec2-user** vừa tạo.

   ![IAM](/images/2/2.3/Create_user_set_permission.png?width=90pc)

   - Tiếp tục đến bước **Create user**.

{{% notice info %}}
Nếu bạn chọn **autogenerated password**, nên sao chép mật khẩu vào notepad hoặc text editor để tránh mất quyền truy cập.
{{% /notice %}}

   - Sau khi user được tạo, quyền của user sẽ như sau:

   ![IAM](/images/2/2.3/Create_user_result.png?width=90pc)

{{% notice info %}}
Đây chỉ là môi trường demo để minh họa rằng khi instance được gắn tag `isolated`, người dùng bình thường với policy này sẽ không thể terminate instance đó. Trong thực tế, bạn nên làm theo khuyến nghị bảo mật sử dụng **temporary credentials** theo [best practice của Well-Architected Framework](https://docs.aws.amazon.com/en_us/wellarchitected/latest/framework/sec-02.html)
{{% /notice %}}

Sau khi tạo **testuser** xong, hãy tiếp tục đến bước tiếp theo [Cấu hình phản hồi](../../3-Configure-Response)
